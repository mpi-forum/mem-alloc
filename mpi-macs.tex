% Version as of April 8, 1997

%   ----------------------------------------------------------------------
%   mpi-macs.tex  --- man page macros,
%                discuss, missing, mpifunc macros
%
% ----------------------------------------------------------------------

% TeX if definitions.  These are defined here so (a) there is one place to
% change the defaults and (b) so that they can be changed by reading a
% configuration file
% Control the use of color
\newif\ifusecolor
\usecolortrue
% Control whether changes are highlighted
\newif\ifshowchange
\showchangetrue
% Control whether deleted text is shown
\newif\ifshowdelete
\showdeletetrue
% Control the use of change "bars" (really markers).  Note that
% both changetrue and changebarstrue must not be set
\newif\ifchangebars
\changebarstrue
% Control whether tickets are indicated in the margins (or inline, when 
% they occur in inner mode.  Note that this has no effect if \showchangetrue
% is not set
\newif\ifshowtickets
\showticketstrue
% For publisher's additions in the printed book
\newif\ifbookprinting
\bookprintingfalse

%
% There are a number of features that are controlled by LaTeX if commands.
% This step allows you to control these through a configuration file
% This file should contain valid LaTeX commands, including comments (using
% the standard % character for comments)
%
% Known commands include:
% \showchangetrue   - Show changes/additions (from a previous version)
% \showdeletetrue   - Show deleted text (deleted from a previous version)
% \changebarstrue   - Show change "bars" around changes (really begin/end
%                     markers in the output file)
% \usecolortrue     - Use color to show changes
% 
\newread\cfgin
% Because these macros are for the mpi-report, first load in this order:
%  mpi-report.cfg
%  ../mpi-report.cfg
%  \jobname.cfg
\openin\cfgin=\jobname.cfg
\ifeof\cfgin\relax
\else
\closein\cfgin
\input \jobname.cfg
\fi
\openin\cfgin=mpi-report.cfg
\ifeof\cfgin
    \openin\cfgin=../mpi-report.cfg
    \ifeof\cfgin\relax
    \else
      \closein\cfgin
      \input ../mpi-report.cfg
    \fi    
\else
\input mpi-report.cfg
\closein\cfgin
\fi

%
% General text color update macros
% These permit the use of nesting of the color changes, as well as
% a "do not change" option
%
\ifusecolor
\definecolor{orange}{rgb}{1,0.5,0}
\definecolor{purple}{rgb}{0.8,0,1}
\let\XA=\expandafter
% Definition for "Use current color"
\def\ColorSame{same}
% Create a stack that is 5 deep (no arrays in TeX)
\def\ColorS{black}
\def\ColorSi{same}
\def\ColorSii{same}
\def\ColorSiii{same}
\def\ColorSiiii{same}
% Stack pointer
\newcount\ColorStackP 
\ColorStackP=0
% Push a new color
\def\ColorPush#1{%
\global\advance\ColorStackP 1\relax%
\ifnum\ColorStackP>4\message{Font Color stack too deep}\fi%
\ifnum\ColorStackP=1\global\def\ColorSi{#1}\else
\ifnum\ColorStackP=2\global\def\ColorSii{#1}\else
\ifnum\ColorStackP=3\global\def\ColorSiii{#1}\else
\ifnum\ColorStackP=4\global\def\ColorSiiii{#1}%
\fi
\fi
\fi
\fi
\def\ColorCur{#1}%
\ifx \ColorCur\ColorSame \relax\else \color{#1}\fi
}
% Pop that color
\def\ColorPop{\global\advance\ColorStackP -1\relax%
\ifnum\ColorStackP<0\message{Font Color stack < 0}\fi%
\ifnum\ColorStackP=0\def\ColorCur{\ColorS}\else
\ifnum\ColorStackP=1\def\ColorCur{\ColorSi}\else
\ifnum\ColorStackP=2\def\ColorCur{\ColorSii}\else
\ifnum\ColorStackP=3\def\ColorCur{\ColorSiii}\else
\ifnum\ColorStackP=4\def\ColorCur{\ColorSiiii}%
\fi
\fi
\fi
\fi
\fi%\typeout{cur = \ColorCur and same = \ColorSame}%
\ifx\ColorCur\ColorSame\relax\else\color{\ColorCur}\fi%
}
% A synonym for color that is controlled by the \usecolortrue command
\def\Color#1{\color{#1}}
\else
\def\ColorPush#1{}
\def\ColorPop{}
\def\Color#1{}
\fi % \ifusecolor


% For MPI-2.2
%
% Use the following to mark the changes to MPI 2.1 to 2.2
%
%   \MPIupdateBegin{2.2}{ticket-number}
%   ... changed text
%   \MPIupdateEnd{2.2}
% A short form,
%   \MPIupdate{2.2}{ticket-number}{update}
% may be used for very short changes, and
%   \MPIreplace{2.2}{ticket-number}{old text}{new text}
%
% Deletions should be marked (where possible) with

%   \MPIdeleteBegin{2.2}{ticket-number}
%   % ... deleted text, commented out in LaTeX
%   % % ... comment out comments as well
%   \MPIdeleteEnd{2.2}
% A short form,
%   \MPIdelete{2.2}{ticket-number}{text to delete}
% may be used for short deletions.
%
% If the \MPIdelete... form cannot be used, then 
% removed or replaced text should be commented out if at all possible
%
% The ticket-number should be the ticket from the MPI 2.2 wiki/tickets; this
% provides a link to the specific proposal that was adopted
%
% ulem is a package that supports operations such as strike out (\sout).  
% Unfortunately, ulem breaks some of the other macros (such as \func)
%\usepackage{ulem}
%\normalem
% 
% Catcode 9 is ignore
% Catcode 14 is comment character
% Catcode 13 is special (activate a command)
% Special characters are \{}$&<return>#^_ (catcodes 0-8 resp.)
\ifshowdelete
\def\nocomment{\catcode`\%=9}
\def\restorecomment{\catcode`\%=14}
\else
\let\nocomment=\relax
\let\restorecomment=\relax
\fi

\ifchangebars
\def\BegChange{\begchange}
\def\EndChange{\endchange}
\else
\let\BegChange=\relax
\let\EndChange=\relax
\fi

\ifshowchange
%
% Use margin par for the ticket number unless marginpar won't work, in 
% which case inline the ticket number.  To do more would require special
% code for the TeX output routine, which isn't worth it for what we need 
% here.
% Note that the changebars and the ticket both use marginpar, and if both 
% are used at the same time, LaTeX may run out of floats
\ifchangebars
\def\ticket#1{\relax}
\else
\ifshowtickets
\def\ticket#1{\ifinner[ticket#1.]\else\protect\marginpar[\mbox{\hbox to \marginparwidth{\hss ticket#1.\hspace{30pt}}}]{\hbox to \marginparwidth{\hspace{30pt}ticket#1.\hss}}\fi}
\else
\def\ticket#1{\relax}
\fi % showtickets
\fi % changebars

\newcommand{\MPIupdateBegin}[2]{\ticket{#2}\BegChange\ColorPush{red}\relax}
\newcommand{\MPIupdateEnd}[1]{\ColorPop\EndChange}
\newcommand{\MPIupdate}[3]{\ticket{#2}\BegChange{\Color{red}\relax#3}\EndChange}
\newcommand{\MPIreplace}[4]{\ticket{#2}\BegChange\ifshowdelete{\Color{purple}[#3]}\fi{\Color{red}\relax#4}\EndChange}

\newcommand{\MPIdeleteBegin}[2]{\ticket{#2}\ifshowdelete\BegChange\ColorPush{purple}[\nocomment\fi\relax}
\newcommand{\MPIdeleteEnd}[1]{\ifshowdelete]\restorecomment\ColorPop\EndChange\fi}
\newcommand{\MPIdelete}[3]{\ticket{#2}\ifshowdelete\BegChange{\Color{purple}[#3]}\EndChange\else\relax\fi}
\else
%
% It turns out that the pdflatex \color command can affect the spacing
% (This appears to be a result of the need to change the TeX output routine
% to ensure that a color change persists across a page).  To attempt to make 
% the versions that differ only in color to have the exact same pagination,
% we push and pop the same color (black)
\newcommand{\MPIupdateBegin}[2]{\relax\relax\color{black}\relax}
\newcommand{\MPIupdateEnd}[1]{\color{black}\relax}
\newcommand{\MPIupdate}[3]{\relax\relax{\color{black}\relax#3}\relax}
\newcommand{\MPIreplace}[4]{\relax\relax{\color{black}\relax#4}\relax}

\newcommand{\MPIdeleteBegin}[2]{\relax}
\newcommand{\MPIdeleteEnd}[1]{\relax}
\newcommand{\MPIdelete}[3]{\relax}

\fi

% fancyvrb defines Verbatim, which is a slightly better Verbatim environment
% Regrettably, the key feature needed, commandchars, does not work correctly
% in our environment (it doesn't accept arbitrary grouping characters).
% See README-2.2 for instructions on using Verbatim along with the above 
% update macros.
\usepackage{fancyvrb}

% From MPI-1.1
% ------------

%\newcommand{\snir}{\marginpar[\mbox{$\bf \top$}]{
%\mbox{\hspace{0.3in} $\bf \top$}}}
%\newcommand{\rins}{\marginpar[\mbox{$\bf \bot$}]{
%\mbox{\hspace{0.3in} $\bf \bot$}}}

%\newcommand{\snir}{\marginpar[\hspace*{14mm} $\top$]{\hspace*{4mm} $\top$}}
%\newcommand{\rins}{\marginpar[\hspace*{14mm} $\bot$]{\hspace*{4mm} $\bot$}}

\def\snir{\relax}
\def\rins{\relax}

% From MPI-1.3
% ------------

% Macros for changing MPI-1.1 / adding features of MPI-1.2
% To show the changes: 
%   \newcommand{\CHANGE}[2]{\noindent{\bf CHANGE (source:#1):} {\it #2}}
%   \newcommand{\INTO}[1]{\noindent{\bf INTO:} #1}
%   \newcommand{\ADD}[2]{\noindent{\bf ADD (source:#1):} {\it #2}}
%   \newcommand{\DELETE}[2]{\noindent{\bf DELETE (source:#1):}{\it #2}}
% To make the changes without showing the location or old source: 
    \newcommand{\CHANGE}[2]{}
    \newcommand{\INTO}[1]{#1}
    \newcommand{\ADD}[2]{#2}
    \newcommand{\DELETE}[2]{}

% For merging MPI-1.3 with MPI-2.0
% --------------------------------
 
%\def\mpimergecolor#1{\color{#1}}      % for coloring the drafts
%\def\mpimergecolor#1{\color{black}}   % for final version without draft-coloring
\def\mpimergecolor#1{\relax}   % for final version without draft-coloring - make NO changes in color
 
% available: red green blue cyan yellow magenta
 
\def\mpiiidotiMergeFromONEdotTHREEbegin{\mpimergecolor{black}}    % marking text that was in MPI-1.3 source 
\def\mpiiidotiMergeFromTWOdotZERObegin{\mpimergecolor{blue}}      % marking text that was in MPI-2.0 source
\def\mpiiidotiMergeNEWforMERGEbegin{\mpimergecolor{cyan}}         % marking text that was necessary for technical merge
\def\mpiiidotiMergeFromBALLOTbegin#1#2{\mpimergecolor{green}}     % marking text-modifications coming from #1=Ballot-number #2=item-number
\def\mpiiidotiMergeFromREVIEWbegin#1{\mpimergecolor{cyan}}        % marking text-modifications coming from #1=Review-number.item-number
\def\RVWCAP/{}                                                       % shortcut for Review item 23.a - capitalization of titles (in \section}
% \def\RVWcap/{\mpiiidotiMergeFromREVIEWbegin{23.a}}                   % shortcut for Review item 23.a - capitalization of titles
\def\RVWcap/{}                                                       % shortcut for Review item 23.a - capitalization of titles
\def\mpiiidotiMergeNEWforSINGLEbegin{\mpimergecolor{red}}         % marking text that was necessary for making a single MPI 2.1 text,
                                                                  % i.e., to remove MPI-1 and MPI-2 differences;
                                                                  % most done by the chapter authors
\def\mpiiidotiMergeFinalREVIEWbegin#1{\mpimergecolor{magenta}}    % marking text that was changed based on the final MPI 2.1 decisions of
                                                                  % the MPI Forum meeting, April 28-30, 2008; #1=Review-number.item-number
 
\def\mpiiidotiMergeFromONEdotTHREEend{\mpimergecolor{black}}
\def\mpiiidotiMergeFromTWOdotZEROend{\mpimergecolor{black}}
\def\mpiiidotiMergeNEWforMERGEend{\mpimergecolor{black}}
\def\mpiiidotiMergeFromBALLOTendI#1#2{\mpiiidotiMergeFromONEdotTHREEbegin}     % return into MPI-1 text
\def\mpiiidotiMergeFromBALLOTendII#1#2{\mpiiidotiMergeFromTWOdotZERObegin}     % return into MPI-2 text
\def\mpiiidotiMergeFromREVIEWendI#1{\mpiiidotiMergeFromONEdotTHREEbegin}       % return into MPI-1 text
\def\mpiiidotiMergeFromREVIEWendII#1{\mpiiidotiMergeFromTWOdotZERObegin}       % return into MPI-2 text
\def\mpiiidotiMergeNEWforSINGLEendI{\mpiiidotiMergeFromONEdotTHREEbegin}       % return into MPI-1 text
\def\mpiiidotiMergeNEWforSINGLEendII{\mpiiidotiMergeFromTWOdotZERObegin}       % return into MPI-2 text
\def\mpiiidotiMergeFinalREVIEWendI#1{\mpiiidotiMergeFromONEdotTHREEbegin}      % return into MPI-1 text
\def\mpiiidotiMergeFinalREVIEWendII#1{\mpiiidotiMergeFromTWOdotZERObegin}      % return into MPI-2 text
 
\def\OnlyForAutomaticAnnexGeneration#1{}% deleting the content were the macro is used; but preserving it for the Annex

 
% MPI-2.1 Correction: 42.l  -  due to Reviews at MPI-2.1 Forum meeting April 26-28, 2008
% 
% For correct usage of \_ together with pdflatex:
% This macro enables that all "_" (underscore) characters in the pfd
% file are searchable, and that cut&paste will copy the "_" as underscore. 
% Without the following macro, the \_ is treated in searches and cut&paste
% as a " " (space character). 
% This macro does not modify the behavior of _ in math or in verbatim 
% environments. In verbatim environments, the "_" is always treated
% as a searchable character.
%
\DeclareRobustCommand{\_}{\texttt{\char`\_}} 
% 
% MPI-2.1 End of correction
 

% From MPI-2.0
% ------------
 
% Place some penalty for doing the break
% The penalty for a ``\gb'' should be greater than a \hyphenpenalty.
% \hyphenpenalty is 50 in plain.tex.
\def\gb{\penalty10000\hskip 0pt plus 8em\penalty4800\hskip 0pt plus-8em%
\penalty10000}

% A theorem-like environment for code Examples (S. Otto) see Lamport, pg 58
%
% Note that because we use a theorem environment that resets the counter
% with every chapter, pdflatex will issue a warning for each example that
% has the same number as an example in another chapter.  This is too hard
% to fix (the easist way is to not use the theorem environment and roll
% a custom environment, including adding the necessary low-level commands
% for the pdf link support.
\newtheorem{example}{Example}[chapter]
% Theorems have \em text; we want \rm.  The easiest way to fix this, 
% since we are not using Theorems, is to change the @begintheorem macro
\makeatletter
\def\@begintheorem#1#2{\rm \trivlist \item[\hskip \labelsep{\bf #1\ #2}]}
\makeatother
% Use \exindex{MPI\_FUNC} to generate an index entry for MPI
% functions/constants 
%\newcommand{\exindex}[1]{\relax}
\newcommand{\exindex}[1]{\index{EXAMPLES:#1}}

% a couple of commands from Marc Snir, modified S. Otto

\newlength{\discussSpace}
\setlength{\discussSpace}{.4cm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Used for JOD and draft version of full document
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\newcommand{\discuss}[1]{\vspace{\discussSpace} {\small {\bf Discussion:} #1} \vspace{\discussSpace}}
%% long discussion
%\newenvironment{discussion}{\begin{list}{}{}\item[]{\it Discussion.}}{{\rm ({\it End of discussion.})} \end{list}}

%\newcommand{\missing}[1]{\vspace{\discussSpace} {\small {\bf Missing:} #1} \vspace{\discussSpace}}

%\newcommand{\alter}[1]{\vspace{\discussSpace} {\small {\bf Alternatives:} #1} \vspace{\discussSpace}}

%\newcommand{\status}[1]{\vspace{\discussSpace} {\small {\bf Current Status:} #1} \vspace{\discussSpace} }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Used for final version of full document - removes comments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\discuss}[1]{}

% long discussion
\bgroup\catcode`\{=10\catcode`\}=10\catcode`\[=1\catcode`\]=2\long\gdef\Eatdiscussion#1end{discussion}[\relax\end[discussion]]\relax\egroup\newenvironment{discussion}{\bgroup\def\do##1{\catcode`##1=10}\dospecials\Eatdiscussion}{\egroup}

\newcommand{\missing}[1]{}

\newcommand{\alter}[1]{}

\newcommand{\status}[1]{}

% special comment command for last round
%\newcommand{\question}[1]{\vspace{\discussSpace} {\small {\bf Question:} #1} \vspace{\discussSpace}}
\newcommand{\question}[1]{}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Use this to make pages start on the right side
\newcommand{\startchap}[0]{\cleardoublepage}
%\newcommand{\startchap}[0]{\relax}

\newlength{\codeSpace}
\setlength{\codeSpace}{.4cm}

\def\MPI/{\textsf{MPI}}    % MPI macro -- see TEX Book, pg 8,204 bloody TEX!!
\def\mpi/{\textsf{MPI}}    % MPI macro
\def\MPIT/{\textsf{MPIT}}    % MPI macro -- see TEX Book, pg 8,204 bloody TEX!!
\def\mpit/{\textsf{MPIT}}    % MPI macro
\def\PMPIT/{\textsf{PMPIT}}    % MPI macro -- see TEX Book, pg 8,204 bloody TEX!!
\def\pmpit/{\textsf{PMPIT}}    % MPI macro
\def\MPII/{\textsf{MPI-1}} % MPI-1 macro -- can't easily do MPI1
\def\mpii/{\textsf{MPI-1}} % MPI-1 macro
\def\MPIIDOTO/{\textsf{MPI-1.0}}   % MPI-1.0 macro - NOTE it has a O (Oh)
                                % not 0 (zero)
\def\mpiidoto/{\textsf{MPI-1.0}}   % MPI-1.0 macro - NOTE it has a O (Oh)
                                % not 0 (zero)
\def\MPIIDOTI/{\textsf{MPI-1.1}}   % MPI-1.1 macro
\def\mpiidoti/{\textsf{MPI-1.1}}   % MPI-1.1 macro
\def\MPIIDOTII/{\textsf{MPI-1.2}}  % MPI-1.2 macro
\def\mpiidotii/{\textsf{MPI-1.2}}  % MPI-1.2 macro
\def\MPIIDOTIII/{\textsf{MPI-1.3}}  % MPI-1.3 macro
\def\mpiidotiii/{\textsf{MPI-1.3}}  % MPI-1.3 macro
\def\MPIII/{\textsf{MPI-2}}        % MPI-2 macro -- can't easily do MPI2
\def\mpiii/{\textsf{MPI-2}}        % MPI-2 macro
\def\MPIIIDOTO/{\textsf{MPI-2.0}}  % MPI-2.0 macro - NOTE it has a O (Oh)
                                % not 0 (zero)
\def\mpiiidoto/{\textsf{MPI-2.0}}  % MPI-2.0 macro - NOTE it has a O (Oh)
                                % not 0 (zero)
\def\MPIIIDOTI/{\textsf{MPI-2.1}}  % MPI-2.1 macro
\def\mpiiidoti/{\textsf{MPI-2.1}}  % MPI-2.1 macro
\def\MPIIIDOTII/{\textsf{MPI-2.2}} % MPI-2.2 macro
\def\mpiiidotii/{\textsf{MPI-2.2}} % MPI-2.2 macro
\def\MPIIII/{\textsf{MPI-3}}       % MPI-3 macro -- can't easily do MPI3
\def\mpiiii/{\textsf{MPI-3}}       % MPI-3 macro
\def\mpiiv/{\textsf{MPI-4}}        % MPI-4 macro
\def\mpiivdoti/{\textsf{MPI-4.1}}  % MPI-4.1 macro
\def\MPIJOD/{\textsf{MPI-JOD}}     % MPI-JOD macro
\def\mpijod/{\textsf{MPI-JOD}}     % MPI-JOD macro
\def\MPIRT/{\textsf{MPI/RT}}       % RT MPI macros.

\def\MPIR/{\textsf{MPIR}}
\def\MEMALLOCVERSION/{1.0}

\def\MEMALLOCDATE/{XXXX 2024}
\def\MEMALLOCDOC/{\textsf{Memory Allocation Kinds}}

\def\MPIRIDOTO/{\textsf{MPIR-1.0}}
\def\MPIRIDOTODATE/{October 11, 2010}

\def\MPIRIDOTI/{\textsf{MPIR-1.1}}
\def\MPIRIDOTIDATE/{March 1, 2018}

\def\RMA/{\textsf{RMA}}    % RMA macro -- see TEX Book, pg 8,204 bloody TEX!!

\def\MPIHACC/{\textsf{MPI Forum Hyrbid and Accelerator Working Group}}

\newcommand{\uu}[1]{\underline{\hyperpage{#1}}} 
\newcommand{\mpifuncmainindex}[1]{\index{#1|uu}} 
\newcommand{\mpifuncindex}[1]{\index{#1}} 
\newcommand{\typedefindex}[1]{\index{TYPEDEF:#1}}
\newcommand{\cdeclindex}[1]{\index{CONST:#1}}        %  for index entry of C declarations like MPI_Comm
\newcommand{\cdeclmainindex}[1]{\index{CONST:#1|uu}}
 
\newenvironment{funcdef}[1]{    
    \vspace{\codeSpace}
    \vspace{\codeSpace}
    \noindent
    \samepage
    {\funcNoIndex{#1}}\mpifuncmainindex{#1}
    \begin{list}{}{                     % see pg 113 of Lamport's book
        \setlength{\leftmargin}{200pt} 
        \setlength{\labelwidth}{180pt} 
        \setlength{\labelsep}{10pt} 
        \setlength{\itemindent}{0pt}
        \setlength{\itemsep}{0pt}
        \setlength{\topsep}{5pt}
    }
}{\end{list} \vspace{\codeSpace}}

% special for functions that you don't want listed in index.
% This was added for showing corrections to functions already listed.
\newenvironment{funcdefnolist}[1]{      
    \vspace{\codeSpace}
    \vspace{\codeSpace}
    \noindent
    \samepage
    {\func{#1}}
    \begin{list}{}{                     % see pg 113 of Lamport's book
        \setlength{\leftmargin}{200pt} 
        \setlength{\labelwidth}{180pt} 
        \setlength{\labelsep}{10pt} 
        \setlength{\itemindent}{0pt}
        \setlength{\itemsep}{0pt}
        \setlength{\topsep}{5pt}
    }
}{\end{list} \vspace{\codeSpace}}

\newenvironment{funcdef2}[2]{   
    \vspace{\codeSpace}
    \vspace{\codeSpace}
    \noindent
    \samepage
    {\funcNoIndex{#1}\linebreak \funcNoIndex{#2}}\mpifuncmainindex{#1#2}
    \begin{list}{}{                     % see pg 113 of Lamport's book
        \setlength{\leftmargin}{200pt} 
        \setlength{\labelwidth}{180pt} 
        \setlength{\labelsep}{10pt} 
        \setlength{\itemindent}{0pt}
        \setlength{\itemsep}{0pt}
        \setlength{\topsep}{5pt}
    }
}{\end{list} \vspace{\codeSpace}}

% Special funcdef for functions with no arguments
\newenvironment{funcdefna}[1]{
    \vspace{\codeSpace}
    \vspace{\codeSpace}
    \noindent
    {\funcNoIndex{#1}}\mpifuncmainindex{#1}\par
}{\vspace{\codeSpace}}

\newenvironment{cfuncdef}[1]{   
    \vspace{\codeSpace}
    \noindent
    C binding:

    \noindent
    \samepage
    {\cfunc{#1}}
    \begin{list}{}{                     % see pg 113 of Lamport's book
        \setlength{\leftmargin}{200pt} 
        \setlength{\labelwidth}{180pt} 
        \setlength{\labelsep}{10pt} 
        \setlength{\itemindent}{0pt}
        \setlength{\itemsep}{0pt}
        \setlength{\topsep}{5pt}
    }
}{\end{list} \vspace{\codeSpace}}

\newenvironment{ffuncdef}[1]{   
    \vspace{\codeSpace}
    \noindent
    Fortran binding:

    \noindent
    \samepage
    {\ffunc{#1}}
    \begin{list}{}{                     % see pg 113 of Lamport's book
        \setlength{\leftmargin}{200pt} 
        \setlength{\labelwidth}{180pt} 
        \setlength{\labelsep}{10pt} 
        \setlength{\itemindent}{0pt}
        \setlength{\itemsep}{0pt}
        \setlength{\topsep}{5pt}
    }
}{\end{list} \vspace{\codeSpace}}

                                        % see page 77, the TeX book.
% WDG - Change 7/21/09 - Use textsf instead of type to avoid generating a 
% bogus "CONST" index entry for the function argument intent (\IN, \OUT, 
% or \INOUT).
\newcommand{\funcarg}[3]{\item[\hbox to 45pt{\textsf{#1} \hfill} \mpiarg{#2}\hfill]{\small #3}}
% \newcommand{\cfuncarg}[3]{\item[\hbox to 70pt{\ctype{#1} \hfill} \carg{#2}\hfill]{\small #3}} % currently not used
% \newcommand{\ffuncarg}[3]{\item[\hbox to 45pt{\ftype{#1} \hfill} \farg{#2}\hfill]{\small #3}} % currently not used


\newcommand{\func}[1]{\gb\textsf{#1}\mpifuncindex{#1}}
% MPI-1.2: NoIndex version for internal use inside of this mpi-maxs.tex file: 
\newcommand{\funcNoIndex}[1]{\gb\textsf{#1}}
% MPI-2.1: mpifunc with index 
\newcommand{\mpifunc}[1]{\gb\textsf{#1}\mpifuncindex{#1}}  % for MPI functions - language independent
% for ones that don't go in index:
\newcommand{\mpiskipfunc}[1]{\gb\textsf{#1}}               % ... same, but not in the Function Index
\newcommand{\cfunc}[1]{\gb\textsf{#1}}
\newcommand{\ffunc}[1]{\gb\textsf{#1}}
\newcommand{\const}[1]{\protect\gb\protect{\textsf{\small #1}}\index{CONST:#1}}
%\newcommand{\const}[1]{\protect\gb\protect{\small\sf #1}\index{CONST:#1}}
% for ones not to be included in index
\newcommand{\constskip}[1]{\protect\gb\protect{\textsf{\small #1}}}
% for ones from  MPI-1
\newcommand{\consti}[1]{\protect\gb\protect{\textsf{\small #1}}\index{CONST:#1}} % constants/handles - language independent
%\newcommand{\consti}[1]{\protect\gb\protect{\small\sf #1}\index{CONST:#1}} % constants/handles - language independent
\newcommand{\constiskip}[1]{\protect\gb\protect{\textsf{\small #1}}}             % ... same, but not in the Constant Index
% \newcommand{\cconst}[1]{\gb\textsf{#1}}                                     % C constants (currently unused)
% \newcommand{\fconst}[1]{\gb\textsf{#1}}                                     % Fortran constants (currently unused)
\newcommand{\constitem}[2]{\item[\const{#1}\hfill]{#2}}
\newcommand{\constitemtwo}[3]{\item[\const{#1}, \const{#2}\hfill]{#3}}
\newcommand{\constitemthree}[4]{\item[\const{#1}, \const{#2}, \const{#3}\hfill]{#4}}
% for ones that don't go in index
\newcommand{\constskipitem}[2]{\item[\constskip{#1}\hfill]{#2}}
\newcommand{\mpiarg}[1]{\gb\textsf{#1}}                % argument in the argument list of an MPI routine, language independent
\newcommand{\mpishortarg}[1]{\textsf{#1}}                % ... same but without \gb panelty
% \newcommand{\carg}[1]{\gb\textsf{#1}}                  % currently not used
% \newcommand{\farg}[1]{\gb\textsf{#1}}                  % currently not used
\newcommand{\type}[1]{\gb\textsf{#1}\index{CONST:#1}}  % datatype handles
%
\newcommand{\gtype}[1]{\textsf{#1}} % generic (language independent) type
\newcommand{\shorttype}[1]{\textsf{#1}\index{CONST:#1}}  % ... same but without \gb panelty
\newcommand{\ctype}[1]{\gb\texttt{#1}}                 % - and corresponding C type
\newcommand{\ftype}[1]{\gb\texttt{#1}}                 % - and corresponding Fortran type
%
% Info is for MPI_Info predefined strings.  \infokey{keyname} and
% \infoval{keyvaluename}
\newcommand{\info}[1]{\protect\gb\protect{\small\sf #1}\index{CONST:#1}}
\newcommand{\infoval}[1]{\protect\gb\protect{\small\sf #1}\index{CONST:#1}}
\let\infokey=\infoval
\newcommand{\infoskip}[1]{\protect\gb\protect{\small\sf #1}}
%
\newcommand{\error}[1]{\protect\gb\protect{\small\sf #1}\index{CONST:#1}}
\newcommand{\errorskip}[1]{\protect\gb\protect{\small\sf #1}}
\newcommand{\errori}[1]{\protect\gb\protect{\small\sf #1}}

\newcommand{\IN}[0]{{\small IN}}
\newcommand{\OUT}[0]{{\small OUT}}
\newcommand{\INOUT}[0]{{\small INOUT}}

\def\class{$\langle$CLASS$\rangle$}

\newenvironment{constlist}[0]{  
    \vspace{\codeSpace}
    \noindent
    \begin{list}{}{                     % see pg 113 of Lamport's book
        \setlength{\leftmargin}{200pt} 
        \setlength{\labelwidth}{190pt} 
        \setlength{\labelsep}{10pt} 
        \setlength{\itemindent}{10pt}
        \setlength{\itemsep}{-5pt}
        \setlength{\topsep}{-5pt}
    }
}{\end{list} \vspace{\codeSpace}}

%       some commands from Bill Gropp

\def\code#1{\texttt{#1}}
\def\setmargin#1{\begingroup\leftmargin #1 \advance\leftmargin\labelsep 
                 \leftmargini #1 \advance\leftmargini\labelsep}
\def\esetmargin{\endgroup}
\def\ibamount{3.0cm\relax}
\def\ibaamount{4.0cm}
\def\ibdamount{4.5cm}
\def\ibcamount{2.0cm}
\def\ib#1{\hbox to \ibamount{#1\hfil}}
\def\iba#1{\hbox to \ibaamount{#1\hfil}}
\def\ibd#1{\hbox to \ibdamount{#1\hfil}}
\def\ibc#1{\hbox to \ibcamount{#1\hfil}}

% Use \code{...} for code fragments
%\def\code#1{\texttt{#1}}
% Use \df{name} for a definition of name in the text
\def\df#1{{\bf #1}}
% Use \note{text} for marginal notes
\def\note#1{\marginpar{\bf #1}}

%
% Get line numbers in the gutters.  Thanks to Guy Steele and HPFF!
%

\makeatletter
%
% This is used to put line numbers on plain pages.  Used in draft.tex
%
\def\withlinenumbers{\relax
  \def\@evenfoot{\hbox to 0pt{\hss\LineNumberRuler\hskip 1.5pc}\hfil}\relax
  \def\@oddfoot{\hfil\hbox to 0pt{\hskip 1.5pc\LineNumberRuler\hss}}}

\def\LineNumberRuler{\vbox to 0pt{\vss\normalsize \baselineskip13.6pt
    \lineskip 1pt \normallineskip 1pt \def\baselinestretch{1}\relax
    \LNR{1}\LNR{2}\LNR{3}\LNR{4}\LNR{5}\LNR{6}\LNR{7}\LNR{8}\LNR{9}
    \LNR{10}\LNR{11}\LNR{12}\LNR{13}\LNR{14}
        \LNR{15}\LNR{16}\LNR{17}\LNR{18}\LNR{19}
    \LNR{20}\LNR{21}\LNR{22}\LNR{23}\LNR{24}
        \LNR{25}\LNR{26}\LNR{27}\LNR{28}\LNR{29}
    \LNR{30}\LNR{31}\LNR{32}\LNR{33}\LNR{34}\LNR{35}
        \LNR{36}\LNR{37}\LNR{38}\LNR{39}
    \LNR{40}\LNR{41}\LNR{42}\LNR{43}\LNR{44}
        \LNR{45}\LNR{46}\LNR{47}\LNR{48}
    \vskip 31pt}}
\def\LNR#1{\hbox to 1pc{\hfil\tiny#1\hfil}}

% jmm; merge the withlinenumbers stuff into
% the centered page numbers that tex defines by default
%\def\ps@plainwithlinenumbers{\let\@mkboth\@gobbletwo
%     \def\@oddhead{}
%     \def\@oddfoot{\hfil\rm\thepage\hfil
%       \hbox to 0pt{\hskip 1.5pc\LineNumberRuler\hss}}
%     \def\@evenhead{}
%     \def\@evenfoot{\hbox to 0pt{\hss
%     \LineNumberRuler\hskip 1.5pc}\rm\hfil\thepage\hfil}}

% The old version; uncommenting the withlinenumbers part didn't
% work because that macro replaced the footer definition that
% did page numbering.
%\def\ps@plainwithlinenumbers{\ps@plain}%\withlinenumbers}
% end jmm changes

%
% 1st page of a chapter has its own page style, so we have to put line
% numbers in here also.
%
\newwrite\chappages
\immediate\openout\chappages=chappage.txt
\def\writespace{ }
%
% Contents is done with \chapter*{Contents}, so we need to turn off the
% line numbers in this case.  Easiest to look at def
%
\def\incontents{0}
\newif\ifcontents
\contentsfalse
\def\chapter{\clearpage
  \ifcontents
  \else
      \thispagestyle{plainwithlinenumbers}
  \fi
  \write\chappages{Chapter \thechapter\writespace - \the\count0}
  \global\@topnum\z@ \@afterindentfalse \secdef\@chapter\@schapter
}

%
% Change "Chapter" to "Chapter", "Appendix" to "Annex"
%
\renewcommand{\chaptername}{Chapter} 
\renewcommand{\appendixname}{Annex} 
% ... old code does not work correctly with pdflatex  
% \def\@chapapp{Chapter}
% \def\appendix{\par
%  \setcounter{chapter}{0}
%  \setcounter{section}{0}
%  \def\@chapapp{Annex}
%  \def\thechapter{\Alph{chapter}}}

\makeatother


%
% Also from HPFF.  These look potentially useful.
%

\newenvironment{rationale}{\begin{list}{}{}\item[]{\it Rationale.}
}{{\rm ({\it End of rationale.})} \end{list}}

\newenvironment{implementors}{\begin{list}{}{}\item[]{\it Advice
        to implementors.}
}{{\rm ({\it End of advice to implementors.})} \end{list}}

\newenvironment{users}{\begin{list}{}{}\item[]{\it Advice to users.}
}{{\rm ({\it End of advice to users.})} \end{list}}



%
% Use Sans Serif font for sections, etc.  S. Otto
%
\makeatletter
\def\section{\@startsection {section}{1}{\z@}{-3.5ex plus -1ex minus 
-.2ex}{2.3ex plus .2ex}{\Large\sf}}
\def\subsection{\@startsection{subsection}{2}{\z@}{-3.25ex plus -1ex minus 
-.2ex}{1.5ex plus .2ex}{\large\sf}}
\def\subsubsection{\@startsection{subsubsection}{3}{\z@}{-3.25ex plus 
-1ex minus -.2ex}{1.5ex plus .2ex}{\normalsize\sf}}
\def\paragraph{\@startsection {paragraph}{4}{\z@}{3.25ex plus 1ex 
minus .2ex}{-1em}{\normalsize\sf}}
\makeatother
%
% An Editor's Note macro
%
\def\ednote#1{{\sl Editor's note: #1}}

% a way to comment out large sections of text
\newcommand{\commentOut}[1]{{}}

%
%  A few commands to help in writing MPI man pages
%
\def\twoc#1#2{
\begin{list}
{\hbox to95pt{#1\hfil}}
{\setlength{\leftmargin}{120pt}
 \setlength{\labelwidth}{95pt}
 \setlength{\labelsep}{0pt}
 \setlength{\partopsep}{0pt}
 \setlength{\parskip}{0pt}
 \setlength{\topsep}{0pt}
}
\item
{#2}
\end{list}
}
\outer\long\def\onec#1{
\begin{list}
{}
{\setlength{\leftmargin}{25pt}
 \setlength{\labelwidth}{0pt}
 \setlength{\labelsep}{0pt}
 \setlength{\partopsep}{0pt}
 \setlength{\parskip}{0pt}
 \setlength{\topsep}{0pt}
}
\item
{#1}
\end{list}
}
\def\manhead#1{\noindent{\bf{#1}}}

\makeatletter
%
% make our own index environment that can have a different
% title than just "Index" -- S. Otto
%
\def\@index{Index}
\def\@introtext{}  % MPI-2.1
\newif\if@restonecol
\def\myindex{\@restonecoltrue\if@twocolumn\@restonecolfalse\fi
\columnseprule \z@
%\columnsep 35pt\twocolumn[\@makeschapterhead{Index}]
 %\@mkboth{INDEX}{INDEX}\thispagestyle{plain}\parindent\z@
%\columnsep 35pt\twocolumn[\@makeschapterhead{\@index}]
\columnsep 35pt\twocolumn[\@makeschapterhead{\@index}\@introtext\vspace{15pt}] % MPI-2.1
 \@mkboth{\@index}{\@index}\thispagestyle{plain}\parindent\z@
 \parskip\z@ plus .3pt\relax\let\item\@idxitem}
\def\@idxitem{\par\hangindent 40pt}
\def\subitem{\par\hangindent 40pt \hspace*{20pt}}
\def\subsubitem{\par\hangindent 40pt \hspace*{30pt}}
\def\endmyindex{\if@restonecol\onecolumn\else\clearpage\fi}
\def\indexspace{\par \vskip 10pt plus 5pt minus 3pt\relax}
\makeatother

%macros for language binding: mpibind, mpifbind, and fargs:

\newcommand{\mpibind}[1]{{\raggedright \hangindent 7em\hangafter=1\tt
int #1 \par \vspace{0.1in}}} 
\newcommand{\mpibindnotint}[1]{{\raggedright \hangindent 7em\hangafter=1\tt
#1 \par \vspace{0.1in}}} 

\newcommand{\mpicppbind}[1]{{\raggedright \hangindent
7em\hangafter=1\tt #1 \par \vspace{0.1in}}} 
%\newcommand{\mpicppbindS}[1]{{\raggedright \hangindent
%7em\hangafter=1\tt #1 \par \vspace{0.1in}}} 
%% This change to the mpicppbind macro is from MPI 2.2, ticket #150
%\newcommand{\mpicppemptybind}[2]{{\raggedright \hangindent
%7em\hangafter=1\tt #2 #1 \par \vspace{0.1in}}}
\newcommand{\mpicppemptybind}[2]{{\raggedright \hangindent
7em\hangafter=1\MPIupdate{2.2}{150}{\{}\tt #2 #1 \rm\MPIupdate{2.2}{150}{{\it (binding deprecated, see Section~\ref{sec:deprecated-cxx-bindings})} \}}\par \vspace{0.1in}}}

%special macro for no including C binding in index
\newcommand{\mpiskipbind}[1]{{\raggedright \hangindent
7em\hangafter=1\tt int #1 \par \vspace{0.1in}}} 
\newcommand{\mpicppskipemptybind}[2]{{\raggedright \hangindent
7em\hangafter=1\tt #2 #1 \par \vspace{0.1in}}}

% special macro that avoids the int in front
% should be used for C functions only that want to be in index
\newcommand{\mpiemptybind}[2]{{\raggedright \hangindent
7em\hangafter=1\tt #2 #1 \par \vspace{0.1in}}}
%
% This version indexes the name
% \mpiemptybindidx{routine}{returnvalue}{indexed name}
\newcommand{\mpiemptybindidx}[3]{{\raggedright \hangindent
7em\hangafter=1\tt #2 #1 \mpifuncmainindex{#3}\par \vspace{0.1in}}}
%
% This version does not index the name, but has same argument list
\newcommand{\mpiemptybindNOidx}[3]{{\raggedright \hangindent
7em\hangafter=1\tt #2 #1 \par \vspace{0.1in}}}

% special macro that avoids the int in front
% should be used for routines where don't want in index
\newcommand{\mpiskipemptybind}[2]{{\raggedright \hangindent 
7em\hangafter=1\tt #2 #1 \par \vspace{0.1in}}}

% special macro for typedef int in front of SUBROUTINE in C
%
% Note that this is indexed.
\newcommand{\mpitypedefbind}[1]{{\raggedright \hangindent 7em\hangafter=1\tt
typedef int #1; \index{TYPEDEF:#1}\par \vspace{0.1in}}}
\newcommand{\mpitypedefbindvoid}[1]{{\raggedright \hangindent 7em\hangafter=1\tt
typedef void #1; \index{TYPEDEF:#1}\par \vspace{0.1in}}}
%
% Version without index
\newcommand{\mpitypedefskipbind}[1]{{\raggedright \hangindent 7em\hangafter=1\tt
typedef int #1; \par \vspace{0.1in}}}
%
% Use this for typedef (second arg is type)
\newcommand{\mpitypedefemptybind}[2]{{\raggedright \hangindent
7em\hangafter=1\tt typedef #2 #1; \index{TYPEDEF:#1}\par \vspace{0.1in}}}
\newcommand{\mpitypedefemptyskipbind}[2]{{\raggedright \hangindent
7em\hangafter=1\tt typedef #2 #1;\par \vspace{0.1in}}}

\newcommand{\mpicpptypedefbind}[1]{{\raggedright \hangindent
7em\hangafter=1\tt typedef #1; \par \vspace{0.1in}}}
%\newcommand{\mpicppskiptypedefbind}[1]{{\raggedright \hangindent
%7em\hangafter=1\tt typedef #1; \par \vspace{0.1in}}}
\newcommand{\mpicppskiptypedefbind}[1]{{\raggedright \hangindent
7em\hangafter=1\MPIupdate{2.2}{150}{\{}\tt typedef #1; \MPIupdate{2.2}{150}{{\it (binding deprecated, see Section~\ref{sec:deprecated-cxx-bindings})}\}}\par \vspace{0.1in}}}

%\newcommand{\mpicpptypedefemptybind}[2]{{\raggedright \hangindent
%7em\hangafter=1\tt typedef #2 #1; \par \vspace{0.1in}}}
\newcommand{\mpicpptypedefemptybind}[2]{{\raggedright \hangindent
7em\hangafter=1\MPIupdate{2.2}{150}{\{}\tt typedef #2 #1; \MPIupdate{2.2}{150}{{\it (binding deprecated, see Section~\ref{sec:deprecated-cxx-bindings})} \}}\par \vspace{0.1in}}}

\newcommand{\mpifsubbind}[1]{{\raggedright \hangindent
7em\hangafter=1\tt SUBROUTINE #1 \par \vspace{0.1in}}}

\newcommand{\mpifbind}[1]{{\raggedright \hangindent 7em\hangafter=1\tt
#1 \par \vspace{0.1in}}}

% special macro to skip fortran binding in index
\newcommand{\mpifskipbind}[1]{{\raggedright \hangindent
7em\hangafter=1\tt #1 \par \vspace{0.1in}}}

\def\fargs{\\\advance\leftskip 2em}

\raggedbottom

% from binding chapter for appendix B.
% -*- latex -*-

\makeatletter
\newbox\arg@box

\def\separator{\rule{\linewidth}{0.5pt}}
\def\function#1{\texttt{#1}}
\def\variable#1{\texttt{#1}}
\def\cli#1{\texttt{#1}}

\def\subtitle{\pagebreak[3]\@ifstar{\@subtit@star}{\@subtit@norm}}
\def\@subtit@star#1{
  \item[\hbox{\normalsize\sf\begin{tabular}[t]{l}#1\end{tabular}}\hfill]
  \hfil\par
  \expandafter{\let\par=\space\ignorespaces\let\par=\endgraf}
}
\def\@subtit@norm#1{
  \setbox\arg@box=\hbox{\normalsize\sf\begin{tabular}[t]{l}#1\end{tabular}}
  \ifdim \wd\arg@box > \labelwidth \item[\copy\arg@box\hfill]\hfil\par
  \else \dp\arg@box=0pt \item[\copy\arg@box\hfill] \fi
  \expandafter{\let\par=\space\ignorespaces\let\par=\endgraf}
}

\newenvironment{manpage}[3]{\@beginManpage#1\@@#2\@@#3\@@}{\@endManpage}

\def\@beginManpage#1\@@#2\@@#3\@@{
  \addcontentsline{toc}{subsection}{#2}
  \clearpage    
  \begin{list}{}{
      \setlength\labelwidth{1.2in}
      \setlength\leftmargin{\labelwidth}
      \addtolength\leftmargin{\labelsep}
      \topsep  5pt plus 2pt minus 2pt
      \itemsep 5pt plus 2pt minus 2pt
      \parsep 10pt plus 2pt minus 2pt
      \raggedbottom
      }
    }

\def\@endManpage{\end{list} \clearpage \flushbottom}

\makeatother

% The next set of macros define change marks for the document
%----------------------------------------------------------------------
% intended for general change marks not associated with a certain version
%\def\begchange{\marginpar[\hspace*{-60pt}\mbox{\hspace*{10pt}
%$\top$ \tiny (General)}]{\mbox{$\top$ \tiny (General)}}}
%\def\endchange{\marginpar[\hspace*{-60pt}\mbox{\hspace*{10pt}
%$\bot$ \tiny (General)}]{\mbox{$\bot$ \tiny (General)}}}
%
% These versions are careful to generate no extraneous error messages 
% about overfull boxes
%
% Because they use marginpar, they can't be used everywhere.  If 
% marginpar isn't available, they do *not* add any marks.
%
\def\begchange{\ifinner\else\protect\marginpar[\mbox{\hbox to
    \marginparwidth{\hss\mbox{\hspace*{10pt}$\top$ \tiny
        (Fin2)}\hspace*{30pt}}}]{\hbox to \marginparwidth{\mbox{$\top$ \tiny (Fin2)}\hss}}\fi}
\def\endchange{\ifinner\else\protect\marginpar[\mbox{\hbox to \marginparwidth{\hss\mbox{\hspace*{10pt}$\bot$ \tiny (Fin2)}\hspace*{30pt}}}]{\hbox to \marginparwidth{\mbox{$\bot$ \tiny (Fin2)}\hss}}\fi}
%get rid of these change marks
%\def\begchange{}
%\def\endchange{}

% MS: new changebar settings
\newcommand{\toolchangebeg}[1]{\cbstart{\color{green}#1}\xspace}
\newcommand{\toolchangeend}{\cbend}
%\cbcolor{red}

%\def\chg0206[#1]{\begtoolchange #1 \endtoolchange}
\newcommand{\chgfeba}[1]{\toolchangebeg{#1}\toolchangeend}
\newcommand{\chgfebb}[1]{\toolchangebeg{#1}\toolchangeend}

\renewcommand{\textfraction}{0.07}
\renewcommand{\floatpagefraction}{0.9}
\setcounter{topnumber}{10}
\setcounter{bottomnumber}{10}
\setcounter{totalnumber}{20} 
   
\def\eg{e.g.}

\usepackage{listings}
\usepackage{inconsolata}

\definecolor{MPIlightgrey}{RGB}{240,240,240}

% Adjust the default style
\lstset{language=C,
        keepspaces=true,
        showstringspaces=false,
        basicstyle=\small\ttfamily,
        columns=fixed,
%        columns=fixed,basewidth=0.5em,
%        columns=fixed,basewidth=0.6em,
        backgroundcolor=\color{MPIlightgrey},
}

% Define an "MPI" dialect of default C.  This is required to get
% the morekeywords option to work, and is more in keeping with the design
% of the listing package.
\lstdefinelanguage[MPI]{C}[]{C}%
{%
        keywordsprefix={MPI_},%
% We must list any PMPI names
        morekeywords={PMPI_Init,PMPI_T_init_thread,PMPI_T_pvar_get_num,%
PMPI_T_pvar_get_info,PMPI_T_pvar_session_create,PMPI_T_pvar_handle_alloc,%
PMPI_T_pvar_start,PMPI_T_pvar_read,PMPI_T_pvar_handle_free,%
PMPI_T_pvar_session_free,PMPI_T_finalize,PMPI_Example,%
PMPI_Finalize,PMPI_Recv,PMPI_Send,%
% mpi info keys used in examples
mpi_assert_memory_alloc_kinds,
mpi_hw_resource_type,
mpi_memory_alloc_kinds,
},%
% make #pragma a "keyword" so that it doesn't need to start in column 1,
% which is a requirement in the lstlisting package for directives
        otherkeywords={\#pragma},
}

% Define an "MPI" dialect of default C++.  This is required to get
% the morekeywords option to work, and is more in keeping with the design
% of the listing package.
\lstdefinelanguage[MPI]{C++}[]{C++}%
{%
        keywordsprefix={MPI_},%
% We must list any PMPI names
        morekeywords={PMPI_Init,PMPI_T_init_thread,PMPI_T_pvar_get_num,%
PMPI_T_pvar_get_info,PMPI_T_pvar_session_create,PMPI_T_pvar_handle_alloc,%
PMPI_T_pvar_start,PMPI_T_pvar_read,PMPI_T_pvar_handle_free,%
PMPI_T_pvar_session_free,PMPI_T_finalize,PMPI_Example,%
PMPI_Finalize,PMPI_Recv,PMPI_Send,%
% mpi info keys used in examples
mpi_assert_memory_alloc_kinds,
mpi_hw_resource_type,
mpi_memory_alloc_kinds,
},%
% make #pragma a "keyword" so that it doesn't need to start in column 1,
% which is a requirement in the lstlisting package for directives
        otherkeywords={\#pragma},
}

% New indexing for indices
% Use \Exindex{language}{shorttitle}{namelist}
% as in
% \Exindex{C}{Use of send and receive}{MPI\_Send,MPI\_Recv}
% The name list may contain any mixture of:
%   MPI Function names
%   MPI Declarations (e.g., MPI_Aint), expressed as d:name, e.g., d:MPI_Aint
%   MPI Constants (e.g., MPI_COMM_WORLD), expressed as c:name
%   MPI Callback Typedefs (e.g., MPI_Handler_function), expressed as t:name
%\newif\ifexindexerror
%\exindexerrorfalse
%\newcommand{\Exindex}[3]{\ifInExample\IImpiindex{NEWEXAMPLES:\arabic{chapter}.\arabic{example}::#1::#2::#3}\else\ifexindexerror\errmessage{Exindex used outside of an example}\else\IImpiindex{NEWEXAMPLES:NA::#1::#2::#3}\typeout{Warning: Exindex used outside of an example}\fi\fi}
%----------------------------------------------------------------------

\newcommand{\appref}[1]{Appendix~\ref{#1}}
\newcommand{\appsref}[2]{Appendices~\ref{#1} and~\ref{#2}}
\newcommand{\chapref}[1]{Chapter~\ref{#1}}
\newcommand{\secref}[1]{Section~\ref{#1}}
\newcommand{\secsref}[2]{Sections~\ref{#1} and~\ref{#2}}
\newcommand{\figref}[1]{Figure~\ref{#1}}
\newcommand{\figsref}[2]{Figures~\ref{#1} and~\ref{#2}}
\newcommand{\exref}[1]{Example~\ref{#1}}
\newcommand{\exsref}[2]{Examples~\ref{#1} and~\ref{#2}}
\newcommand{\tabref}[1]{Table~\ref{#1}}

